######################################################################################################################################
######################################################################################################################################
######################################################################################################################################
######################################################################################################################################

# the original script is : the_script_in_R_make_scatter_plots_v4_reinspect_24april2020_and_BARPLOTS_CELL_CYCLE.R

######################################################################################################################################
######################################################################################################################################
######################################################################################################################################
######################################################################################################################################

library("limma")
library("ggplot2")

######################################################################################################################################
######################################################################################################################################
######################################################################################################################################
######################################################################################################################################

file.genes = read.delim("analysis.LIMMA.integrating.all.samples.with.data.table.printing.FPKM.and.CELL.CYCLE.txt", 
                         header=T, sep="\t", stringsAsFactors=F)


dim(file.genes)
colnames(file.genes)

######################################################################################################################################
######################################################################################################################################
######################################################################################################################################
######################################################################################################################################

file.genes.subset = subset(file.genes, select = c("GENE_NAME",  "...")
dim(file.genes.subset)


######################################################################################################################################
######################################################################################################################################
######################################################################################################################################
######################################################################################################################################


file.cell.cycle =  read.delim("CELL_CYCLE.from.paper.EVAN.v3.GENES.to.display.FC.txt.only.from.ARTICLE.txt", header=T, sep="\t", stringsAsFactors=F)

dim(file.cell.cycle)

######################################################################################################################################
######################################################################################################################################
######################################################################################################################################
###################################################################################################################################### 

file.cell.cycle.and.info.all = merge(file.cell.cycle,  
                                     file.genes,
                                     by.x = "GENE",
                                     by.y = "GENE_NAME", 
                                     all = FALSE) 
  
dim(file.cell.cycle.and.info.all)

colnames(file.cell.cycle.and.info.all)

write.table(file.cell.cycle.and.info.all, 
                                     file="file.GENES.cell.cycle.and.info.FPKM.log2FC.FDR.about.all.txt", 
                                      quote=FALSE, 
                                      row.names = FALSE, 
                                      sep="\t")  

######################################################################################################################################
######################################################################################################################################
######################################################################################################################################
######################################################################################################################################
######################################################################################################################################
######################################################################################################################################
######################################################################################################################################
######################################################################################################################################

file.cell.cycle.and.info = merge(file.cell.cycle,  
                                 file.genes.subset,
                                  by.x = "GENE",
                                  by.y = "GENE_NAME", 
                                  all = FALSE) 
  
colnames(file.cell.cycle.and.info)


write.table(file.cell.cycle.and.info, file="file.GENES.cell.cycle.and.info.FPKM.log2FC.FDR.about.KH7.txt", 
                                      quote=FALSE, 
                                      row.names = FALSE, 
                                      sep="\t")  

######################################################################################################################################
######################################################################################################################################
######################################################################################################################################
######################################################################################################################################

######################################################################################################################################
######################################################################################################################################
###################################################################################################################################### display the BOXPLOTS 
###################################################################################################################################### FPKM

for (i in 1:dim(file.cell.cycle.and.info)[1]) 
{
    # print(file.cell.cycle.and.info$GENE[i])

    MAX = max(c(file.cell.cycle.and.info$DMSO_lane1.FPKM.average[i], 
                file.cell.cycle.and.info$DMSO_lane2.FPKM.average[i], 
                file.cell.cycle.and.info$Aph_KH7.FPKM.average[i],
                file.cell.cycle.and.info$KH7.FPKM.average[i]) )

    png(paste("the.bar.plots.of.FPKM", file.cell.cycle.and.info$ONTOLOGY[i], "gene", 
                                      file.cell.cycle.and.info$GENE[i], "png", sep="."), height=800, width=400)
   
    barplot(c(file.cell.cycle.and.info$DMSO_lane1.FPKM.average[i], 
              file.cell.cycle.and.info$DMSO_lane2.FPKM.average[i], 
              file.cell.cycle.and.info$Aph_KH7.FPKM.average[i], 
              file.cell.cycle.and.info$KH7.FPKM.average[i]),
          ylim=c(0, MAX+1), 
          main=paste(file.cell.cycle.and.info$GENE[i],
                     file.cell.cycle.and.info$ONTOLOGY[i], sep=":"), 
          xlab="samples",
          ylab="gene expression (FPKM)",
          col=c("blue", "violet", "red",  "green") )

    dev.off()  
}

######################################################################################################################################
######################################################################################################################################
###################################################################################################################################### 
######################################################################################################################################

######################################################################################################################################
######################################################################################################################################
###################################################################################################################################### display the BOXPLOTS 
###################################################################################################################################### FC 

for (i in 1:dim(file.cell.cycle.and.info)[1]) 
{
    # print(file.cell.cycle.and.info$GENE[i])

    MAX = abs(max(c(file.cell.cycle.and.info$logFC.Aph_KH7[i], 
                file.cell.cycle.and.info$logFC.KH7[i] )))

    # MIN = min(c(file.cell.cycle.and.info$logFC.Aph_KH7[i], 
    #            file.cell.cycle.and.info$logFC.KH7[i] ))

    png(paste("the.bar.plots.of.FC", file.cell.cycle.and.info$ONTOLOGY[i], "gene", 
                                     file.cell.cycle.and.info$GENE[i], "png", sep="."), height=800, width=200)
   
    barplot(c(file.cell.cycle.and.info$logFC.Aph_KH7[i], 
                file.cell.cycle.and.info$logFC.KH7[i] ),
             ylim=c(-MAX-1, MAX+1), 
             main=paste(file.cell.cycle.and.info$GENE[i],
                     file.cell.cycle.and.info$ONTOLOGY[i], sep=":"), 
          # xlab="samples",
          xlab=c("Aph_KH7", "KH7"), 
          ylab="log2FC",
          col=c("red",  "green") )

    dev.off()  
}

######################################################################################################################################
######################################################################################################################################
######################################################################################################################################
######################################################################################################################################
######################################################################################################################################
######################################################################################################################################
